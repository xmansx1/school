{% extends "base.html" %}
{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…{% endblock %}

{% block head %}
<style>
  .wrap{max-width:1100px;margin:0 auto}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 6px 20px rgba(2,6,23,.06);padding:16px}
  .title{margin:0 0 10px;font-weight:900;color:#0f172a}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;font-weight:800;text-decoration:none}
  .btn-primary{background:linear-gradient(135deg,#2563eb,#3b82f6);border-color:transparent;color:#fff}
  .btn-danger{background:#fee2e2;color:#991b1b;border-color:#fecaca}
  .table-wrap{overflow:auto;border:1px solid #e5e7eb;border-radius:12px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:12px 10px;border-bottom:1px solid #e5e7eb;white-space:nowrap}
  thead th{background:#f8fafc;text-align:right;font-weight:900}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#f8fafc;font-weight:800}
  .muted{color:#6b7280}
  .actions{display:flex;gap:6px;flex-wrap:wrap}
</style>
{% endblock %}

{% block content %}
<div class="wrap">
  <div class="card">
    <h2 class="title">ğŸ·ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h2>

    <div class="toolbar">
      {% url 'reports:departments_add' as departments_add_url %}
      <a class="btn btn-primary" href="{{ departments_add_url|default:'#' }}">â• Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</a>
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Ø§Ù„Ù…Ø¹Ø±Ù‘Ù/Ø§Ù„ÙƒÙˆØ¯</th>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</th>
            <th>Ø§Ù„ØªØ°Ø§ÙƒØ± (Ù…ÙØªÙˆØ­Ø© / Ù‚ÙŠØ¯ / Ù…Ù†Ø¬Ø²Ø©)</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody>
          {% for d in departments %}
          <tr>
            <td>{{ forloop.counter }}</td>

            <td>
              <code>
                {% if d.code %}{{ d.code }}
                {% elif d.slug %}{{ d.slug }}
                {% else %}â€”{% endif %}
              </code>
            </td>

            <td>{{ d.name|default:"â€”" }}</td>

            <td>
              <span class="pill">{% if d.is_active %}Ù†Ø´Ø·{% else %}Ù…ÙˆÙ‚Ù‘Ù{% endif %}</span>
            </td>

            <td>
              {# Ø¥Ù† ÙƒØ§Ù† Ø¹Ù†Ø¯Ùƒ members_count Ø¬Ø§Ù‡Ø² Ø§Ø³ØªØ®Ø¯Ù…Ù‡ØŒ ÙˆØ¥Ù„Ø§ fallback Ø¥Ù„Ù‰ d.members.count #}
              {% if d.members_count is not None %}{{ d.members_count }}
              {% elif d.members %}{{ d.members.count }}
              {% else %}0{% endif %}
            </td>

            <td class="muted">
              {{ d.stats.open|default:"0" }} /
              {{ d.stats.in_progress|default:"0" }} /
              {{ d.stats.done|default:"0" }}
            </td>

            <td class="actions">
              {% url 'reports:department_members' d.pk as dept_members_url %}
              {% url 'reports:department_edit' d.pk as dept_edit_url %}
              {% url 'reports:department_delete' d.pk as dept_delete_url %}

              <a class="btn" href="{{ dept_members_url }}">ğŸ‘¥ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</a>
              <a class="btn" href="{{ dept_edit_url }}">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a>

              <form action="{{ dept_delete_url }}" method="post" style="display:inline"
                    onsubmit="return confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…ØŸ');">
                {% csrf_token %}
                <button class="btn btn-danger" type="submit">ğŸ—‘ Ø­Ø°Ù</button>
              </form>
            </td>
          </tr>
          {% empty %}
            <tr><td colspan="7" class="muted" style="text-align:center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù….</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
