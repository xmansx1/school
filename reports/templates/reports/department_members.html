{% extends "base.html" %}
{% load static %}
{% block title %}Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù‚Ø³Ù…{% endblock %}

{% block head %}
<style>
  /* ØªØ®Ø·ÙŠØ· Ø¹Ø§Ù… */
  .wrap{max-width:1100px;margin-inline:auto;padding:16px}
  .header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
  .breadcrumbs{font-size:.9rem;color:var(--muted-foreground,#6b7280)}
  .breadcrumbs a{color:inherit;text-decoration:none}
  .title{font-size:1.4rem;font-weight:700;margin:.25rem 0}
  .sub{font-size:.95rem;color:var(--muted-foreground,#6b7280)}

  /* Ù„ÙˆØ­Ø© Ø¹Ù„ÙˆÙŠØ© */
  .bar{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;background:var(--card,#fff);
       border:1px solid var(--line,#e5e7eb);border-radius:14px;padding:12px}
  .stat{display:flex;gap:10px;align-items:center}
  .badge{background:var(--accent,#eef2ff);color:var(--accent-foreground,#3730a3);border-radius:999px;padding:4px 10px;font-size:.85rem}

  /* Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
  .hform{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .hform select,.hform button{height:40px}
  .hform select{min-width:220px;border:1px solid var(--line,#e5e7eb);border-radius:10px;padding:0 10px;background:var(--card,#fff)}
  .btn{border:1px solid var(--line,#e5e7eb);background:var(--btn,#111827);color:#fff;border-radius:10px;padding:0 14px;cursor:pointer}
  .btn-secondary{background:var(--muted,#f3f4f6);color:#111827}
  .btn-danger{background:#b91c1c}
  .btn:disabled{opacity:.6;cursor:not-allowed}

  /* Ø£Ø¯ÙˆØ§Øª */
  .tools{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .search{position:relative}
  .search input{height:40px;border:1px solid var(--line,#e5e7eb);border-radius:10px;padding:0 36px 0 12px;min-width:240px;background:var(--card,#fff)}
  .search svg{position:absolute;inset-inline-end:10px;top:50%;transform:translateY(-50%);width:18px;height:18px;opacity:.6}

  /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ */
  .grid{display:grid;gap:12px;margin-top:14px}
  @media (min-width:640px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (min-width:980px){.grid{grid-template-columns:repeat(3,1fr)}}
  .card{display:flex;align-items:center;gap:12px;background:var(--card,#fff);border:1px solid var(--line,#e5e7eb);
        border-radius:14px;padding:12px}
  .avatar{width:42px;height:42px;border-radius:50%;display:grid;place-items:center;font-weight:700;background:var(--muted,#eef2ff)}
  .name{font-weight:700}
  .meta{font-size:.85rem;color:var(--muted-foreground,#6b7280)}
  .card .actions{margin-inline-start:auto;display:flex;gap:6px}
  .empty{border:1px dashed var(--line,#e5e7eb);border-radius:14px;padding:20px;text-align:center;color:var(--muted-foreground,#6b7280)}
</style>
{% endblock head %}

{% block content %}
<div class="wrap" dir="rtl">
  <div class="header">
    <div>
      <div class="breadcrumbs">
        <a href="{% url 'reports:admin_dashboard' %}">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</a> Â·
        <a href="{% url 'reports:departments_list' %}">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</a> Â·
        <span>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</span>
      </div>
      <h1 class="title">ğŸ‘¥ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù‚Ø³Ù…: {% firstof department.name dept_label dept_code "-" %}</h1>
      <div class="sub">
        {% if has_dept_model %}ÙˆØ¶Ø¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ÙÙ‡ÙŠÙƒÙ„ (Department/Member){% else %}ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„ØªØ±Ø§Ø«ÙŠ (Teacher.role){% endif %}
      </div>
    </div>

    <div class="stat">
      <span class="badge">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠÙˆÙ†: {{ members|length }}</span>
      <span class="badge">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ù„Ù‘Ù…ÙŠÙ†: {{ all_teachers|length }}</span>
    </div>
  </div>

  <div class="bar">
    <form class="hform" method="post" action="">
      {% csrf_token %}
      <input type="hidden" name="action" value="add">
      <label for="teacher_id" class="sr-only">Ø¥Ø³Ù†Ø§Ø¯ Ù„Ù…Ø¹Ù„Ù‘Ù…</label>
      <select id="teacher_id" name="teacher_id" required>
        <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù‘Ù…</option>
        {% for t in all_teachers %}
          <option value="{{ t.id }}">{{ t.name }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="btn">Ø¥Ø³Ù†Ø§Ø¯</button>
      <a href="{% url 'reports:departments_list' %}" class="btn btn-secondary" style="display:inline-grid;place-items:center">Ø±Ø¬ÙˆØ¹</a>
    </form>

    <div class="tools">
      <div class="search">
        <input id="q" type="search" placeholder="Ø§Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡â€¦" autocomplete="off">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.2-4.2M10.8 18a7.2 7.2 0 1 1 0-14.4 7.2 7.2 0 0 1 0 14.4z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
      </div>
    </div>
  </div>

  {% if members %}
    <div id="membersGrid" class="grid" aria-live="polite">
      {% for m in members %}
        <div class="card" data-name="{{ m.name|default_if_none:'' }}">
          <div class="avatar" aria-hidden="true">
            {{ m.name|default:"ØŸ"|slice:":2" }}
          </div>
          <div>
            <div class="name">{{ m.name }}</div>
            <div class="meta">
              {% if m.role %}Ø§Ù„Ø¯ÙˆØ±: {{ m.role }}{% else %}&nbsp;{% endif %}
            </div>
          </div>
          <div class="actions">
            <form method="post" onsubmit="return confirm('Ø¥Ù„ØºØ§Ø¡ ØªÙƒÙ„ÙŠÙ {{ m.name }} Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…ØŸ');">
              {% csrf_token %}
              <input type="hidden" name="action" value="remove">
              <input type="hidden" name="teacher_id" value="{{ m.id }}">
              <button type="submit" class="btn btn-danger">Ø¥Ù„ØºØ§Ø¡</button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty">
      Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø¶ÙˆÙŠØ§Øª Ø¨Ø¹Ø¯. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¥Ø³Ù†Ø§Ø¯ Ø£ÙˆÙ„ Ù…Ø¹Ù„Ù‘Ù….
    </div>
  {% endif %}
</div>

<script>
  // ÙÙ„ØªØ±Ø© ÙÙˆØ±ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù…
  (function(){
    const input = document.getElementById('q');
    const grid  = document.getElementById('membersGrid');
    if(!input || !grid) return;
    input.addEventListener('input', function(){
      const q = this.value.trim().toLowerCase();
      const cards = grid.querySelectorAll('.card');
      let shown = 0;
      cards.forEach(c=>{
        const name = (c.dataset.name || '').toLowerCase();
        const ok = !q || name.includes(q);
        c.style.display = ok ? '' : 'none';
        if(ok) shown++;
      });
      grid.setAttribute('aria-busy','false');
      grid.setAttribute('aria-label', 'Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ' + shown);
    });
  })();
</script>
{% endblock content %}
