{# reports/templates/reports/home.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}مرحبا {{ request.user.name|default:"" }}{% endblock %}

{% block head %}
<style>
  /* ===== متغيرات الصفحة ===== */
  .home {
    --ink:#0f172a; --muted:#64748b; --line:#e5e7eb; --line2:#f1f5f9;
    --card:#fff; --brand:#2563eb; --accent:#10b981; --warn:#f59e0b; --danger:#ef4444;
    --radius:16px; --shadow:0 10px 30px rgba(2,6,23,.08); --t:all .22s ease;
  }
  @media (prefers-color-scheme:dark){
    .home { --ink:#e6ebff; --muted:#9fb0d9; --line:#1b2744; --line2:#142349; --card:#0f1629; }
  }

  /* ===== القسم الترحيبي (Hero) ===== */
  .hero-home{
    display:grid; gap:20px; padding:30px clamp(16px,4vw,30px);
    border-radius:var(--radius);
    background:linear-gradient(135deg,#2563eb,#1e40af); color:#fff;
    box-shadow:var(--shadow); position:relative; overflow:hidden;
  }
  .hero-home::before{
    content:""; position:absolute; inset:0;
    background:url("{% static 'img/pattern.svg' %}") no-repeat right 30px bottom -20px;
    background-size:200px; opacity:.15; transform:rotate(180deg);
  }
  .hero-home .content{ position:relative; z-index:10 }
  .hero-home h1{ margin:0; font-size:clamp(1.4rem,4vw,2.2rem); font-weight:900; line-height:1.3; letter-spacing:-.5px; color:#e6ebff }
  .hero-home p{ margin:8px 0 0; font-size:clamp(1rem,2vw,1.15rem); font-weight:800; opacity:.9; max-width:700px }
  .hero-actions{ display:flex; flex-wrap:wrap; gap:12px; margin-top:18px }
  .hero-actions .btn{ border-radius:999px; padding:10px 18px; font-size:1rem; font-weight:800 }

  /* ===== الأزرار ===== */
  .btn{
    display:inline-flex; align-items:center; gap:8px; padding:10px 14px;
    border-radius:12px; border:1px solid var(--line); background:var(--card);
    color:var(--ink); text-decoration:none; font-weight:800; transition:var(--t);
  }
  .btn:hover{ transform:translateY(-2px); box-shadow:0 4px 12px rgba(2,6,23,.05) }
  .btn-primary{ background:var(--brand); border-color:var(--brand); color:#fff }
  .btn-primary:hover{ background:#1e40af; border-color:#1e40af }
  .btn-accent{ background:var(--accent); border-color:var(--accent); color:#003322 }
  .btn-accent:hover{ background:#0d9465; border-color:#0d9465 }
  .btn-ghost{ background:#eef2ff; color:#1e40af; border-color:#dbeafe }
  @media(prefers-color-scheme:dark){ .btn-ghost{ background:#142349; color:#cfe0ff; border-color:#1c2f5d } }
  .btn.outline{ background:transparent } .btn.outline:hover{ background:var(--line2) }

  /* ===== الشبكات ===== */
  .grid{ display:grid; gap:14px }
  @media(min-width:900px){ .grid-3{ grid-template-columns:1.3fr .7fr } }
  .card{
    background:var(--card); border:1px solid var(--line); border-radius:var(--radius);
    box-shadow:var(--shadow); padding:16px; transition:var(--t);
  }
  .card:hover{ transform:translateY(-3px); box-shadow:0 15px 40px rgba(2,6,23,.08) }
  .card h3{ margin:0 0 10px; font-size:1.05rem; font-weight:900; display:flex; align-items:center; gap:8px }
  .card h3 i{ opacity:.8 }
  .meta{ color:var(--muted); font-weight:800; font-size:.95rem }

  /* ===== بطاقات الإحصاءات ===== */
  .stats{ display:grid; gap:12px; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)) }
  .stat{
    position:relative; overflow:hidden; border-radius:14px; padding:14px;
    border:1px solid var(--line);
    background:linear-gradient(180deg,var(--line2),var(--card)); transition:var(--t);
  }
  .stat:hover{ transform:translateY(-2px); box-shadow:0 4px 12px rgba(2,6,23,.05) }
  @media(prefers-color-scheme:dark){ .stat{ background:linear-gradient(180deg,#122043,#0f1629) } }
  .stat .k{ font-size:clamp(1.2rem,2.2vw,1.5rem); font-weight:900; color:var(--ink) }
  .stat .t{ color:var(--muted); font-weight:800 }
  .stat .ico{ position:absolute; inset:auto 10px 10px auto; font-size:22px; opacity:.22 }

  /* ===== القوائم الحديثة ===== */
  .list{ display:grid; gap:10px }
  .row{
    display:grid; gap:10px; padding:12px; border:1px solid var(--line); border-radius:12px;
    grid-template-columns:1fr auto; background:var(--line2); transition:var(--t);
  }
  .row:hover{ background:#dbeafe } @media(prefers-color-scheme:dark){ .row:hover{ background:#1a2c53 } }
  .row strong{ font-weight:900; color:var(--ink) }
  .row .badge{
    align-self:center; justify-self:end; border-radius:999px; padding:4px 10px;
    font-size:.85rem; font-weight:900; color:#fff; white-space:nowrap;
  }
  .b-gray{ background:#64748b } .b-brand{ background:#2563eb } .b-accent{ background:#10b981 }
  .b-warn{ background:#f59e0b } .b-danger{ background:#ef4444 }

  /* ===== زر التحفيز (يفتح النافذة) ===== */
  .motivate{ display:inline-flex; align-items:center; gap:8px; margin-top:6px; cursor:pointer; font-weight:800; color:var(--ink); opacity:.9; transition:var(--t) }
  .motivate:hover{ opacity:1; transform:translateY(-1px) }
  .motivate i{ font-size:1.15rem; color:#f59e0b }
</style>
{% endblock %}

{% block content %}
<div class="home">
  <!-- ===== Hero ===== -->
  <section class="hero-home" aria-labelledby="welcomeTitle">
    <div class="content">
      <h1 id="welcomeTitle">أهلًا {{ request.user.name|default:"بك" }} 👋</h1>
      <p>مرحباً بعودتك! انطلق الآن ووثّق إنجازاتك، وتابع طلباتك، واطّلع على آخر المستجدات.</p>

      <!-- إجراءات سريعة (تتضمن "طلباتي") -->
      <div class="hero-actions">
        <a class="btn" href="{% url 'reports:add_report' %}" style="background:#fff;color:var(--brand);">
          <i class="fa-solid fa-plus"></i> إضافة تقرير جديد
        </a>
        <a class="btn outline" href="{% url 'reports:my_reports' %}" style="color:#eef2ff;">
          <i class="fa-solid fa-file-lines"></i> تقاريري
        </a>
        {% url 'reports:assigned_to_me' as inbox_url %}
        {% if inbox_url %}
          <a class="btn outline" href="{{ inbox_url }}" style="color:#eef2ff;">
            <i class="fa-solid fa-inbox"></i> المعينة لي
          </a>
        {% endif %}
        <!-- ✅ زر طلباتي المُضاف -->
        <a class="btn outline" href="{% url 'reports:my_requests' %}" style="color:#eef2ff;">
          <i class="fa-solid fa-rectangle-list"></i> طلباتي
        </a>
      </div>

      {% if NAV_NOTIFICATION_HERO %}
        <button type="button" class="motivate" onclick="window.showNotification(this)" aria-label="افتح آخر إشعار تحفيزي">
          <i class="fa-solid fa-sparkles"></i> 🎉 حفّزني الآن
        </button>
      {% endif %}
    </div>
  </section>

  <!-- ===== المحتوى ===== -->
  <div class="grid grid-3">
    <!-- يسار: إحصاءات + أحدث تقاريري -->
    <div class="grid" style="align-content:start">
      <div class="card">
        <h3><i class="fa-solid fa-chart-simple"></i> نظرة سريعة</h3>
        <div class="stats" role="list">
          <div class="stat" role="listitem">
            <div class="k">{{ stats.today_count|default:"0" }}</div>
            <div class="t">تقارير اليوم</div>
            <i class="ico fa-solid fa-sun"></i>
          </div>
          <div class="stat" role="listitem">
            <div class="k">{{ stats.total_count|default:"0" }}</div>
            <div class="t">إجمالي تقاريري</div>
            <i class="ico fa-solid fa-layer-group"></i>
          </div>
          <div class="stat" role="listitem">
            <div class="k">{{ req_stats.open|default:"0" }}</div>
            <div class="t">طلبات جـديدة</div>
            <i class="ico fa-solid fa-door-open"></i>
          </div>
          <div class="stat" role="listitem">
            <div class="k">{{ req_stats.in_progress|default:"0" }}</div>
            <div class="t">قيد المعالجة</div>
            <i class="ico fa-solid fa-hourglass-half"></i>
          </div>
        </div>
      </div>

      <div class="card">
        <h3><i class="fa-solid fa-file-circle-check"></i> أحدث تقاريري</h3>
        {% if recent_reports %}
          <div class="list" role="list">
            {% for r in recent_reports %}
            <a class="row" role="listitem" href="{% url 'reports:report_print' r.id %}" title="فتح لطباعة التقرير">
              <div>
                <strong>{{ r.title }}</strong>
                <div class="meta">بتاريخ {{ r.report_date }} — {{ r.day_name }}</div>
              </div>
              <span class="badge b-brand">{{ r.category.name|default:"—" }}</span>
            </a>
            {% endfor %}
          </div>
          <div style="margin-top:16px">
            <a class="btn btn-ghost" href="{% url 'reports:my_reports' %}">
              <i class="fa-solid fa-list"></i> عرض جميع تقاريري
            </a>
          </div>
        {% else %}
          <p class="meta">لا توجد تقارير حديثة بعد.
            <a href="{% url 'reports:add_report' %}"><b>أضف تقريرك الأول الآن!</b></a>
          </p>
        {% endif %}
      </div>
    </div>

    <!-- يمين: حالة الطلبات + دفعة طاقة -->
    <div class="grid" style="align-content:start">
      <div class="card">
        <h3><i class="fa-solid fa-clipboard-check"></i> حالة طلباتي</h3>
        <div class="list" role="list">
          <div class="row" role="listitem">
            <div><strong>مكتملة</strong></div>
            <span class="badge b-accent">{{ req_stats.done|default:"0" }}</span>
          </div>
          <div class="row" role="listitem">
            <div><strong>مرفوضة</strong></div>
            <span class="badge b-danger">{{ req_stats.rejected|default:"0" }}</span>
          </div>
        </div>
        <div style="margin-top:16px; display:flex; gap:8px; flex-wrap:wrap">
          <a class="btn btn-ghost" href="{% url 'reports:request_create' %}">
            <i class="fa-solid fa-ticket"></i> فتح طلب جديد
          </a>
          <a class="btn" href="{% url 'reports:my_requests' %}">
            <i class="fa-solid fa-rectangle-list"></i> طلباتي
          </a>
        </div>
      </div>

      <div class="card" id="motivateCard" aria-live="polite">
        <h3><i class="fa-solid fa-bolt"></i> دفعة طاقة</h3>
        <p class="meta">ابدأ يومك بإنجاز صغير الآن. دقيقة واحدة يمكن أن تصنع فرقًا كبيرًا.</p>
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:16px;">
          <a class="btn btn-primary" href="{% url 'reports:add_report' %}">
            <i class="fa-solid fa-plus"></i> توثيق إنجاز
          </a>
          {% if NAV_NOTIFICATION_HERO %}
          <button type="button" class="btn" onclick="window.showNotification(document.getElementById('motivateCard'))">
            <i class="fa-solid fa-sparkles"></i> عرض الإشعار
          </button>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
