{% extends "base.html" %}
{% load static %}
{% block title %}Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…{% endblock %}

{% block head %}
<style>
  :root{
    --ink:#0f172a; --ink-soft:#1f2937; --muted:#64748b; --line:#e5e7eb;
    --brand:#1e3a8a; --brand-2:#1e40af; --accent:#0b7d62;
    --card:#ffffff; --bg:#f8fafc; --shadow:0 6px 20px rgba(2,6,23,.08); --radius:22px; --t:all .22s ease;
  }
  @media (prefers-color-scheme: dark) {
    :root{
      --ink:#e5e7eb; --ink-soft:#f8fafc; --muted:#cbd5e1; --line:#334155;
      --brand:#93c5fd; --brand-2:#60a5fa; --accent:#34d399;
      --card:#0b1220; --bg:#0a0f1c; --shadow:0 6px 20px rgba(0,0,0,.35);
    }
  }
  *{box-sizing:border-box}
  .container{max-width:1200px;margin:0 auto;padding:18px}

  /* HERO (Ø±Ø³Ù…ÙŠ ÙˆØ¨Ø³ÙŠØ·) */
  .hero{
    background:
      radial-gradient(900px 220px at 100% 0, rgba(99,102,241,.06), transparent 60%),
      linear-gradient(180deg,#fff, #f5f7fb);
    border:1px solid var(--line); border-radius:20px; padding:22px; box-shadow:var(--shadow);
  }
  .hello{font-size:1.6rem; font-weight:900; color:var(--brand)}
  .sub{color:var(--muted); font-weight:700}

  /* GRID */
  .grid{display:grid; gap:22px; margin-top:18px}
  @media(min-width:1024px){ .grid{ grid-template-columns:1.1fr .9fr } }

  /* Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ø¤Ø´Ø±Ø§Øª */
  .kpis{display:grid; gap:14px}
  @media(min-width:640px){ .kpis{ grid-template-columns:repeat(3,1fr) } }
  .kpi{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:18px; text-align:center; box-shadow:var(--shadow)}
  .kpi .num{font-size:1.9rem; font-weight:900; color:var(--brand-2)}
  .kpi .lbl{color:var(--ink-soft); font-weight:900; margin-top:6px}
  .kpi .hint{color:var(--muted); font-size:.9rem}

  /* Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø© */
  .actions{display:grid; gap:14px; margin-top:16px}
  @media(min-width:640px){ .actions{ grid-template-columns:repeat(2,1fr) } }
  .tile{display:flex; gap:14px; align-items:center; background:var(--card); border:1px solid var(--line); border-radius:16px; padding:16px; text-decoration:none; color:var(--ink); box-shadow:var(--shadow); transition:var(--t)}
  .tile:hover{transform:translateY(-4px)}
  .ico{ width:48px; height:48px; border-radius:12px; display:grid; place-items:center; color:#fff; font-size:1.25rem }
  .ico.plus{ background:linear-gradient(135deg, #0ea5e9, #2563eb) }
  .ico.list{ background:linear-gradient(135deg, #6366f1, #3b82f6) }
  .ico.req{ background:linear-gradient(135deg, #10b981, #34d399) }
  .ico.myreq{ background:linear-gradient(135deg, #1e40af, #3b82f6) }
  .ico.mgr{ background:linear-gradient(135deg, #7c3aed, #8b5cf6) }
  .tile-title{ font-weight:900; color:var(--ink-soft) }
  .tile-desc{ color:var(--muted); font-size:.92rem }

  /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
  .card{ background:var(--card); border:1px solid var(--line); border-radius:16px; box-shadow:var(--shadow) }
  .card-hd{ padding:16px 18px; border-bottom:1px solid var(--line); display:flex; align-items:center; justify-content:space-between; gap:12px }
  .card-title{ margin:0; font-size:1.05rem; font-weight:900; color:var(--ink-soft) }
  .list{ display:grid; gap:10px; padding:16px }
  .item{ display:grid; grid-template-columns:1fr auto; gap:12px; border:1px solid var(--line); border-radius:14px; padding:12px; background:var(--card); transition:var(--t) }
  .item:hover{ border-color:#c7d2fe; box-shadow:0 10px 24px rgba(30,58,138,.08) }
  .name{ font-weight:900; color:var(--ink-soft); line-height:1.3 }
  .meta{ color:var(--muted); font-size:.92rem }
  .btns{ display:flex; gap:8px; align-items:center }
  .chip-id{ background:#eff6ff; color:#1e40af; padding:6px 10px; border-radius:999px; font-weight:800; font-size:.85rem }
  .btn-xs{ padding:8px 11px; border-radius:10px; background:#eef2ff; color:#1e3a8a; font-weight:800; text-decoration:none; line-height:1 }
  .btn-xs:hover{ background:#e0e7ff }

  /* Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ù„Ø¨ */
  .status{ padding:6px 12px; border-radius:999px; font-weight:900; font-size:.85rem; display:inline-flex; align-items:center; gap:8px }
  .dot{ width:8px; height:8px; border-radius:50% }
  .s-new{ background:#dcfce7; color:#166534 } .s-new .dot{ background:#16a34a }
  .s-in{ background:#ede9fe; color:#5b21b6 } .s-in .dot{ background:#7c3aed }
  .s-done{ background:#e0f2fe; color:#075985 } .s-done .dot{ background:#0ea5e9 }
  .s-rej{ background:#fee2e2; color:#991b1b } .s-rej .dot{ background:#ef4444 }

  .empty{display:flex; gap:10px; align-items:center; color:var(--muted)}
  .btn-ghost{padding:8px 12px; border-radius:10px; border:1px solid var(--line); background:var(--card); color:var(--ink); font-weight:800; text-decoration:none}
  .btn-ghost:hover{background:#f3f4f6}

  /* A11y */
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
{% endblock %}

{% block content %}
<div class="container">

  <!-- HERO Ø±Ø³Ù…ÙŠ -->
  <section class="hero" role="region" aria-label="Ù…Ù‚Ø¯Ù…Ø©">
    <div>
      {% if request.user.is_authenticated %}
        <div class="hello">Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ request.user.name|default:"Ù…Ø³ØªØ®Ø¯Ù…" }} ğŸ‘‹</div>
      {% else %}
        <div class="hello">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¶ÙŠÙ ğŸ‘‹</div>
      {% endif %}
      <div class="sub">Ø§Ù„ØªØ§Ø±ÙŠØ®: {% now "Y-m-d" %}</div>
    </div>
  </section>

  <!-- Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <section class="grid" aria-label="Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª">
    <div>

      <!-- Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø© (Ø¨Ø¯ÙˆÙ† Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± Ù‡Ù†Ø§) -->
      <nav class="actions" aria-label="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©">
        <a class="tile" href="{% url 'reports:add_report' %}">
          <span class="ico plus" aria-hidden="true">ï¼‹</span>
          <div>
            <div class="tile-title">Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯</div>
            <div class="tile-desc">Ø³Ø¬Ù‘Ù„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„ØµÙˆØ± Ø¨Ø³Ù‡ÙˆÙ„Ø©</div>
          </div>
        </a>

        <a class="tile" href="{% url 'reports:my_reports' %}">
          <span class="ico list" aria-hidden="true">ğŸ“‹</span>
          <div>
            <div class="tile-title">Ø¹Ø±Ø¶ ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ</div>
            <div class="tile-desc">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„ØµÙˆØ±</div>
          </div>
        </a>

        <a class="tile" href="{% url 'reports:request_create' %}">
          <span class="ico req" aria-hidden="true">ğŸ“</span>
          <div>
            <div class="tile-title">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</div>
            <div class="tile-desc">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… ÙˆØ§Ù„Ù…Ø³ØªÙ„Ù… ÙˆØªØ§Ø¨Ø¹ Ø§Ù„Ø­Ø§Ù„Ø©</div>
          </div>
        </a>

        <a class="tile" href="{% url 'reports:my_requests' %}">
          <span class="ico myreq" aria-hidden="true">ğŸ“¦</span>
          <div>
            <div class="tile-title">Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§ØªÙŠ</div>
            <div class="tile-desc">Ø§Ø·Ù‘Ù„Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø§Øª ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</div>
          </div>
        </a>

        {# Ø¨Ø·Ø§Ù‚Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·ØŒ ØªÙ†Ù‚Ù„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± #}
        {% url 'reports:manager_dashboard' as manager_url %}
        {% url 'reports:admin_reports' as fallback_admin %}
        {% if request.user.is_superuser or request.user.role == 'manager' %}
          {% if manager_url %}
          <a class="tile" href="{{ manager_url }}">
            <span class="ico mgr" aria-hidden="true">ğŸ›¡ï¸</span>
            <div>
              <div class="tile-title">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</div>
              <div class="tile-desc">ÙƒÙ„ ÙƒØ±ÙˆØª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙÙŠ ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©</div>
            </div>
          </a>
          {% elif fallback_admin %}
          <a class="tile" href="{{ fallback_admin }}">
            <span class="ico mgr" aria-hidden="true">ğŸ›¡ï¸</span>
            <div>
              <div class="tile-title">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</div>
              <div class="tile-desc">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª</div>
            </div>
          </a>
          {% endif %}
        {% endif %}
      </nav>
    </div>

    <!-- Ø£Ø­Ø¯Ø« Ø¹Ù†ØµØ±ÙŠÙ†: ØªÙ‚Ø§Ø±ÙŠØ± + Ø·Ù„Ø¨Ø§Øª -->
    <aside class="card" aria-label="Ø£Ø­Ø¯Ø« Ø§Ù„Ø¹Ù†Ø§ØµØ±">
      <!-- Ø¢Ø®Ø± ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ (Ø¢Ø®Ø± 2 ÙÙ‚Ø·) -->
      <div class="card-hd">
        <h3 class="card-title">ğŸ•˜ Ø¢Ø®Ø± ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ</h3>
        <a class="btn-ghost" href="{% url 'reports:my_reports' %}">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
      </div>
      <div class="list">
        {% for r in recent_reports|slice:":2" %}
          <div class="item">
            <div>
              <div class="name">{{ r.title|default:"Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†" }}</div>
              <div class="meta">
                Ø§Ù„ØªØ§Ø±ÙŠØ®: {{ r.report_date|date:"Y-m-d"|default:"â€”" }}
                {% if r.day_name %} â€¢ {{ r.day_name }}{% endif %}
                â€¢ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†: {{ r.beneficiaries_count|default:"0" }}
              </div>
            </div>
            <div class="btns">
              <span class="chip-id" title="Ø±Ù‚Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ±">#{{ r.pk }}</span>
              <a class="btn-xs" href="{% url 'reports:report_print' r.pk %}" target="_blank" rel="noopener">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</a>
            </div>
          </div>
        {% empty %}
          <div class="item"><div class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div></div>
        {% endfor %}
      </div>

      <!-- Ø¢Ø®Ø± Ø·Ù„Ø¨Ø§ØªÙŠ (Ø¢Ø®Ø± 2 ÙÙ‚Ø·) -->
      <div class="card-hd">
        <h3 class="card-title">ğŸ“¦ Ø¢Ø®Ø± Ø·Ù„Ø¨Ø§ØªÙŠ</h3>
        <a class="btn-ghost" href="{% url 'reports:my_requests' %}">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
      </div>
      <div class="list">
        {% for t in recent_tickets|slice:":2" %}
          <div class="item">
            <div>
              <div class="name">{{ t.title|default:"Ø·Ù„Ø¨ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†" }}</div>
              <div class="meta">
                Ø§Ù„Ù‚Ø³Ù…: {{ t.get_department_display|default:t.department }} â€¢
                Ø§Ù„Ù…Ø³ØªÙ„Ù…: {% firstof t.assignee.name "â€”" %} â€¢
                Ø¨ØªØ§Ø±ÙŠØ®: {{ t.created_at|date:"Y-m-d H:i" }}
              </div>
            </div>
            <div class="btns">
              <span class="status
                {% if t.status in 'new,open' %}s-new{% elif t.status in 'in_progress,pending' %}s-in
                {% elif t.status == 'done' %}s-done{% else %}s-rej{% endif %}">
                <span class="dot" aria-hidden="true"></span>
                {{ t.get_status_display|default:t.status }}
              </span>
            </div>
          </div>
        {% empty %}
          <div class="item"><div class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div></div>
        {% endfor %}
      </div>
    </aside>
  </section>

</div>
{% endblock %}
