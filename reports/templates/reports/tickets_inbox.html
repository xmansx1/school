{# templates/reports/tickets_inbox.html #}
{% extends "base.html" %}
{% block title %}ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·Ù„Ø¨Ø§Øª{% endblock %}

{% block head %}
<style>
  .inbox-wrap{max-width:1200px;margin-inline:auto}
  .card{
    background:#fff;border:1px solid #e5e7eb;border-radius:14px;
    box-shadow:0 4px 16px rgba(2,6,23,.06);padding:18px
  }
  .title{margin:0 0 12px;font-weight:900;color:#1f2937}

  /* Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© */
  .status-badge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-size:.8rem;font-weight:900;white-space:nowrap}
  .s-open,.s-new{background:#dcfce7;color:#166534}
  .s-in_progress,.s-pending{background:#ede9fe;color:#5b21b6}
  .s-done{background:#e0f2fe;color:#075985}
  .s-rejected,.s-cancelled{background:#fee2e2;color:#991b1b}

  /* Ø´Ø§Ø±Ø© Ø§Ù„Ù‚Ø³Ù… */
  .dept-chip{display:inline-block;background:#eef2ff;color:#1e40af;border:1px solid #dbeafe;border-radius:999px;padding:3px 10px;font-weight:800;font-size:.8rem}

  /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
  .tbl{width:100%;border-collapse:collapse;font-size:14px}
  .tbl th,.tbl td{padding:10px;border-bottom:1px solid #f1f5f9;text-align:right}
  .tbl thead th{background:#f9fafb;border-bottom:1px solid #e5e7eb;color:#0f172a;font-weight:900}
  .actions .btn-open{padding:6px 10px;border-radius:8px;background:#10b981;color:#fff;text-decoration:none;display:inline-block}

  /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„: Ù†Ù‚Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¥Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø§Øª */
  @media(max-width:860px){
    .tbl thead{display:none}
    .tbl, .tbl tbody, .tbl tr, .tbl td{display:block;width:100%}
    .tbl tr{border:1px solid #e5e7eb;border-radius:12px;margin:10px 0;background:#fff}
    .tbl td{border-bottom:1px dashed #e5e7eb}
    .tbl td:last-child{border-bottom:0}
    .tbl td[data-label]::before{
      content:attr(data-label);
      font-weight:900;color:#1f2937;display:inline-block;margin-inline-start:6px
    }
    .actions{display:flex;justify-content:flex-start}
  }
</style>
{% endblock %}

{% block content %}
<div class="container inbox-wrap">
  <div class="card">
    <h2 class="title">ğŸ“¥ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>

    <form method="get" class="filters" style="display:grid;gap:10px;margin:8px 0 14px;">
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;">
        <input type="text" name="q" value="{{ q }}" class="filter-input"
               placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†/Ø§Ù„ØªÙØ§ØµÙŠÙ„"
               style="padding:10px;border:1px solid #d1d5db;border-radius:10px;">
        <select name="status" class="filter-input" style="padding:10px;border:1px solid #d1d5db;border-radius:10px;">
          <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
          {% for v,lbl in status_choices %}
            <option value="{{ v }}" {% if status == v %}selected{% endif %}>{{ lbl }}</option>
          {% endfor %}
        </select>
        <label style="display:flex;align-items:center;gap:8px;">
          <input type="checkbox" name="mine" value="1" {% if mine %}checked{% endif %}>
          Ø§Ù„Ù…Ø¹ÙŠÙ‘Ù†Ø© Ù„ÙŠ ÙÙ‚Ø·
        </label>
      </div>
      <div>
        <button class="btn" style="padding:10px 14px;border-radius:10px;background:#2563eb;color:#fff;border:0;">ØªØ·Ø¨ÙŠÙ‚</button>
        {% if q or status or mine %}
          <a href="{% url 'reports:tickets_inbox' %}" class="btn" style="padding:10px 14px;border-radius:10px;border:1px solid #d1d5db;background:#fff;color:#111827;">Ù…Ø³Ø­</a>
        {% endif %}
      </div>
    </form>

    <div class="table-responsive" style="overflow:auto;">
      <table class="tbl">
        <thead>
          <tr>
            <th>#</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„Ù…Ø±Ø³Ù„</th>
            <th>Ø§Ù„Ù‚Ø³Ù…</th>
            <th>Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
            <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody>
          {% for t in tickets %}
            <tr>
              <td data-label="#"> {{ t.pk }} </td>
              <td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®"> {{ t.created_at|date:"Y-m-d H:i" }} </td>
              <td data-label="Ø§Ù„Ù…Ø±Ø³Ù„"> {{ t.creator.name|default:"â€”" }} </td>

              {# âœ… Ø§Ù„Ù‚Ø³Ù…: ÙŠØ¯Ø¹Ù… ForeignKey Ø£Ùˆ choices Ù…Ø¹ Ø¨Ø¯ÙŠÙ„ Ø¢Ù…Ù† #}
              <td data-label="Ø§Ù„Ù‚Ø³Ù…">
                {% if t.department %}
                  <span class="dept-chip">{{ t.department.name|default:t.department }}</span>
                {% else %}
                  <span class="dept-chip">{{ t.get_department_display|default:"â€”" }}</span>
                {% endif %}
              </td>

              <td data-label="Ø§Ù„Ù…Ø³ØªÙ„Ù…"> {{ t.assignee.name|default:"â€”" }} </td>
              <td data-label="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"> {{ t.title }} </td>

              {# âœ… Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù„ÙˆÙ†Ø© #}
              <td data-label="Ø§Ù„Ø­Ø§Ù„Ø©">
                <span class="status-badge s-{{ t.status|default:'open' }}">
                  {{ t.get_status_display|default:t.status }}
                </span>
              </td>

              <td data-label="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª" class="actions">
                <a href="{% url 'reports:ticket_detail' t.pk %}" class="btn-open">ÙØªØ­</a>
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="8" style="text-align:center;padding:14px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
