{# templates/reports/tickets_inbox.html #}
{% extends "base.html" %}
{% block title %}صندوق الطلبات{% endblock %}

{% block content %}
<div class="container" style="max-width:1200px;">
  <div class="admin-card" style="background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 4px 16px rgba(0,0,0,.06);padding:18px;">
    <h2 style="margin:0 0 12px;font-weight:900;color:#1f2937;">📥 صندوق الطلبات</h2>

    <form method="get" class="filters" style="display:grid;gap:10px;margin:8px 0 14px;">
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;">
        <input type="text" name="q" value="{{ q }}" class="filter-input" placeholder="بحث في العنوان/التفاصيل"
               style="padding:10px;border:1px solid #d1d5db;border-radius:10px;">
        <select name="status" class="filter-input" style="padding:10px;border:1px solid #d1d5db;border-radius:10px;">
          <option value="">كل الحالات</option>
          {% for v,lbl in status_choices %}
            <option value="{{ v }}" {% if status == v %}selected{% endif %}>{{ lbl }}</option>
          {% endfor %}
        </select>
        <label style="display:flex;align-items:center;gap:8px;">
          <input type="checkbox" name="mine" value="1" {% if mine %}checked{% endif %}>
          المعيّنة لي فقط
        </label>
      </div>
      <div>
        <button class="btn" style="padding:10px 14px;border-radius:10px;background:#2563eb;color:#fff;border:0;">تطبيق</button>
        {% if q or status or mine %}
          <a href="{% url 'reports:tickets_inbox' %}" class="btn" style="padding:10px 14px;border-radius:10px;border:1px solid #d1d5db;background:#fff;color:#111827;">مسح</a>
        {% endif %}
      </div>
    </form>

    <div class="table-responsive" style="overflow:auto;">
      <table style="width:100%;border-collapse:collapse;font-size:14px;">
        <thead>
          <tr style="background:#f9fafb;">
            <th style="text-align:right;padding:10px;border-bottom:1px solid #e5e7eb;">#</th>
            <th style="text-align:right;padding:10px;border-bottom:1px solid #e5e7eb;">التاريخ</th>
            <th style="text-align:right;padding:10px;border-bottom:1px solid #e5e7eb;">المرسل</th>
            <th style="text-align:right;padding:10px;border-bottom:1px solid #e5e7eb;">القسم</th>
            <th style="text-align:right;padding:10px;border-bottom:1px solid #e5e7eb;">المستلم</th>
            <th style="text-align:right;padding:10px;border-bottom:1px solid #e5e7eb;">العنوان</th>
            <th style="text-align:right;padding:10px;border-bottom:1px solid #e5e7eb;">الحالة</th>
            <th style="text-align:right;padding:10px;border-bottom:1px solid #e5e7eb;">إجراءات</th>
          </tr>
        </thead>
        <tbody>
          {% for t in tickets %}
            <tr>
              <td style="padding:10px;border-bottom:1px solid #f1f5f9;">{{ t.pk }}</td>
              <td style="padding:10px;border-bottom:1px solid #f1f5f9;">{{ t.created_at|date:"Y-m-d H:i" }}</td>
              <td style="padding:10px;border-bottom:1px solid #f1f5f9;">{{ t.creator.name }}</td>
              <td style="padding:10px;border-bottom:1px solid #f1f5f9;">{{ t.get_department_display }}</td>
              <td style="padding:10px;border-bottom:1px solid #f1f5f9;">{{ t.assignee.name|default:"—" }}</td>
              <td style="padding:10px;border-bottom:1px solid #f1f5f9;">{{ t.title }}</td>
              <td style="padding:10px;border-bottom:1px solid #f1f5f9;">{{ t.get_status_display }}</td>
              <td style="padding:10px;border-bottom:1px solid #f1f5f9;">
                <a href="{% url 'reports:ticket_detail' t.pk %}" class="btn" style="padding:6px 10px;border-radius:8px;background:#10b981;color:#fff;text-decoration:none;">فتح</a>
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="8" style="text-align:center;padding:14px;">لا توجد طلبات</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
